PHP 变量在内核中的实现
===

所有的编程语言都要提供一种数据的存储与检索机制，PHP 也不例外。其它语言大都需要在使用变量之前先定义，并且它的类型也是无法再次改变的，而 PHP 却允许自由的使用变量而无须提前定义，甚至可以随时随意的对已存在的变量转换成其它任何 PHP 支持的数据类型。当程序在运行的时候，PHP还会自动的根据需求转换变量的类型。

变量的类型
---

+ PHP在内核中是通过 zval 这个结构体来存储变量的，它的定义在 Zend/zend.h 文件里，由四个成员组成：
```c
struct _zval_struct {
    zvalue_value value; /* 变量的值 */
    zend_uint refcount__gc;
    zend_uchar type;    /* 变量当前的数据类型 */
    zend_uchar is_ref__gc;
};
typedef struct _zval_struct zval;
```

+ 保存变量值的 value 是 zvalue_value 类型(PHP5)，它是一个 union，同样定义在了 Zend/zend.h 文件里：
```c
typedef union _zvalue_value {
    long lval;          /* long value */
    double dval;        /* double value */
    struct {
        char *val;
        int len;
    } str;
    HashTable *ht;      /* hash table value */
    zend_object_value obj;
} zvalue_value;
```

+ PHP 的八种数据类型
  + IS_NULL
  + IS_BOOL
  + IS_LONG
  + IS_DOUBLE
  + IS_STRING
  + IS_ARRAY
  + IS_OBJECT
  + IS_RESOURCE

+ 检查变量类型的宏函数
```c
#define Z_TYPE(zval)        (zval).type
#define Z_TYPE_P(zval_p)    Z_TYPE(*zval_p)
#define Z_TYPE_PP(zval_pp)  Z_TYPE(**zval_pp)
```

+ [目录](00.目录.md)
+ 上一节: [PHP的生命周期](01.PHP的生命周期.md)
+ 下一节: [内存管理](03.内存管理.md)
